<!DOCTYPE html>
<html>
<head>
    <title>Cloud Browser Pro</title>
    <style>
        body { margin: 0; background: #121212; color: white; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; }
        .nav { padding: 12px; background: #1f1f1f; display: flex; gap: 12px; align-items: center; border-bottom: 1px solid #333; }
        
        /* URL Bar Styling */
        input#url-input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #444; background: #2d2d2d; color: white; outline: none; }
        input#url-input:focus { border-color: #2979ff; }

        #container { flex: 1; background: #000; overflow: hidden; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }
        
        button { padding: 10px 18px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-start { background: #00e676; color: #000; }
        .btn-fs { background: #2979ff; color: #fff; }
        .btn-stop { background: #ff5252; color: #fff; }
        button:hover { filter: brightness(1.2); }
        #loader { font-size: 0.8em; color: #00e676; display: none; }
    </style>
</head>
<body>

    <div class="nav">
        <input type="text" id="url-input" placeholder="Enter URL (e.g. https://github.com)" value="https://google.com">
        <button class="btn-start" onclick="startSession()">Go</button>
        <button class="btn-fs" onclick="goFullscreen()">Full View</button>
        <button class="btn-stop" onclick="stopSession()">Close</button>
        <div id="loader">Spinning up engine...</div>
    </div>

    <div id="container">
        <iframe id="browser-view" src="about:blank"></iframe>
    </div>

    <script>
        const iframe = document.getElementById('browser-view');
        const loader = document.getElementById('loader');
        const urlInput = document.getElementById('url-input');

        async function startSession() {
            const target = encodeURIComponent(urlInput.value);
            loader.style.display = 'block';
            
            try {
                // Pass the URL variable to the backend
                const res = await fetch(`/api/session?url=${target}`);
                const data = await res.json();
                if (data.url) {
                    iframe.src = data.url;
                }
            } catch (e) { 
                alert("Connection failed. Is the server running?"); 
            } finally {
                loader.style.display = 'none';
            }
        }

        async function stopSession() {
            await fetch('/api/kill', { method: 'POST' });
            iframe.src = "about:blank";
        }

        function goFullscreen() {
            const elem = document.getElementById('container');
            if (elem.requestFullscreen) elem.requestFullscreen();
            else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
        }

        // Allow pressing "Enter" to launch
        urlInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") startSession();
        });
    </script>
</body>
</html>
